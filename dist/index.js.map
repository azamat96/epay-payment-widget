{"version":3,"sources":["../src/widget/index.tsx"],"names":["React","useEffect"],"mappings":"AAAA,OAAOA,GAAQ,aAAAC,MAAgB","sourcesContent":["import React, {useEffect} from \"react\";\r\nimport {postData, createPaymentObject, includeJS} from \"./utils\";\r\nimport {apiDevURL, apiProdURL, oauthDevURl, oauthGrantType, oauthProdURl, scope} from \"./constants\";\r\nimport {EpayPaymentWidgetProps} from \"./contracts\";\r\n\r\ndeclare var halyk: any\r\n\r\nconst EpayPaymentWidget = (\r\n    {\r\n        visible,\r\n        clientId,\r\n        clientSecret,\r\n        invoiceId = '' + new Date().valueOf(),\r\n        amount,\r\n        currency = 'KZT',\r\n        paymentData = {},\r\n        terminalId,\r\n        onWidgetClose,\r\n        devMode = false,\r\n        oauthData\r\n    }: EpayPaymentWidgetProps) => {\r\n\r\n    useEffect(() => {\r\n        if (typeof halyk == 'undefined') {\r\n            includeJS(devMode ? apiDevURL : apiProdURL)\r\n        }\r\n    }, []);\r\n\r\n    if (!visible) {\r\n        return null\r\n    }\r\n\r\n    currency = paymentData?.currency ?? currency\r\n    const invoice = (paymentData?.invoiceId || invoiceId) ?? '' + new Date().valueOf()\r\n    amount = paymentData?.amount ?? amount\r\n    terminalId = paymentData?.terminal ?? terminalId\r\n    const showPaymentWidget = (dataAuth: any) => {\r\n        halyk.showPaymentWidget(\r\n            createPaymentObject(dataAuth, invoice, amount, terminalId, currency, paymentData),\r\n            onWidgetClose ?? function () {}\r\n        );\r\n    }\r\n\r\n    if (clientId && clientSecret) {\r\n        const oauthParams = {\r\n            grant_type: oauthGrantType,\r\n            scope: scope,\r\n            client_id: clientId,\r\n            client_secret: clientSecret,\r\n            invoiceID: invoiceId,\r\n            amount: amount,\r\n            currency: currency,\r\n            terminal: terminalId\r\n        }\r\n        postData(devMode ? oauthDevURl : oauthProdURl, oauthParams).then(\r\n            (dataAuth: any) => showPaymentWidget(dataAuth),\r\n            () => alert(\"Authorization request failed\")\r\n        );\r\n    } else {\r\n        showPaymentWidget(oauthData)\r\n    }\r\n\r\n    return (<></>)\r\n}\r\n\r\nexport default EpayPaymentWidget"]}