{"version":3,"sources":["../src/widget/index.tsx","../src/widget/utils.ts","../src/widget/constants.ts"],"names":["React","useEffect","postData","url","data","__async","formData","name","createPaymentObject","auth","invoiceId","amount","terminalId","currency","__spreadProps","__spreadValues","includeJS","jsPath","js","apiDevURL","apiProdURL","oauthDevURl","oauthProdURl","oauthGrantType","scope","EpayPaymentWidget","visible","clientId","clientSecret","paymentData","onWidgetClose","devMode","_a","_b","_c","_d","invoice"],"mappings":"0nBAAA,OAAOA,GAAQ,aAAAC,MAAgB,QCE/B,SAAsBC,EAASC,EAAaC,EAAW,QAAAC,EAAA,sBACnD,IAAMC,EAAY,IAAI,SACtB,QAAUC,KAAQH,EACdE,EAAS,IAAIC,EAAMH,EAAKG,CAAI,CAAC,EAOjC,OAJiB,MAAM,MAAMJ,EAAK,CAC9B,OAAQ,OACR,KAAMG,CACV,CAAQ,GACQ,KAAK,CACzB,GAEO,SAASE,EACZC,EACAC,EACAC,EACAC,EACAC,EAAmB,MACnBT,EAAoB,CAAC,EACvB,CAYE,OAAOU,EAAAC,IAAA,GAXa,CAChB,SAAU,kCACV,gBAAiB,kCACjB,SAAU,sBACV,gBAAiB,qCACjB,SAAU,MACV,YAAa,gJACb,UAAW,YACX,KAAM,YACN,KAAM,+DACV,GAGOX,GAFA,CAGH,KAAAK,EACA,UAAAC,EACA,aAAcA,EACd,OAAAC,EACA,SAAUC,EACV,SAAAC,CACJ,EACJ,CAEO,SAASG,EAAWC,EAAiB,CACxC,IAAMC,EAAK,SAAS,cAAc,QAAQ,EAC1CA,EAAG,aAAa,OAAQ,iBAAiB,EACzCA,EAAG,aAAa,MAAOD,CAAM,EAC7B,SAAS,qBAAqB,MAAM,EAAE,CAAC,EAAE,YAAYC,CAAE,CAC3D,CCnDO,IAAMC,EAAY,uDACZC,EAAa,kDAEbC,EAAc,mDACdC,EAAe,8CAEfC,EAAiB,qBACjBC,EAAQ,6EFAd,IAAMC,EAAoB,CAC7B,CACI,QAAAC,EACA,SAAAC,EACA,aAAAC,EACA,UAAAlB,EAAY,GAAK,IAAI,KAAK,EAAE,QAAQ,EACpC,OAAAC,EACA,SAAAE,EAAW,MACX,YAAAgB,EAAc,CAAC,EACf,WAAAjB,EACA,cAAAkB,EACA,QAAAC,EAAU,EACd,IAA8B,CAnBlC,IAAAC,EAAAC,EAAAC,EAAAC,EA2BI,GANAlC,EAAU,IAAM,CACR,OAAO,OAAS,aAChBe,EAAUe,EAAUZ,EAAYC,CAAU,CAElD,EAAG,CAAC,CAAC,EAED,CAACM,EACD,OAAO,KAGXb,GAAWmB,EAAAH,GAAA,YAAAA,EAAa,WAAb,KAAAG,EAAyBnB,EACpC,IAAMuB,GAAWH,GAAAJ,GAAA,YAAAA,EAAa,YAAanB,IAA1B,KAAAuB,EAAwC,GAAK,IAAI,KAAK,EAAE,QAAQ,EACjF,OAAAtB,GAASuB,EAAAL,GAAA,YAAAA,EAAa,SAAb,KAAAK,EAAuBvB,EAChCC,GAAauB,EAAAN,GAAA,YAAAA,EAAa,WAAb,KAAAM,EAAyBvB,EAYtCV,EAAS6B,EAAUV,EAAcC,EAVb,CAChB,WAAYC,EACZ,MAAOC,EACP,UAAWG,EACX,cAAeC,EACf,UAAWlB,EACX,OAAQC,EACR,SAAUE,EACV,SAAUD,CACd,CAC0D,EACrD,KAAMR,GAAS,CACR,MAAM,kBACFI,EAAoBJ,EAAMgC,EAASzB,EAAQC,EAAYC,EAAUgB,CAAW,EAC5EC,GAAA,KAAAA,EAAiB,UAAY,CAAC,CAClC,CACJ,EACA,IAAM,CACF,MAAM,8BAA8B,CACxC,CAAC,EAED9B,EAAA,cAAAA,EAAA,aAAE,CACd","sourcesContent":["import React, {useEffect} from \"react\";\r\nimport {postData, createPaymentObject, includeJS} from \"./utils\";\r\nimport {apiDevURL, apiProdURL, oauthDevURl, oauthGrantType, oauthProdURl, scope} from \"./constants\";\r\nimport {EpayPaymentWidgetProps} from \"./contracts\";\r\n\r\ndeclare var halyk: any\r\n\r\nexport const EpayPaymentWidget = (\r\n    {\r\n        visible,\r\n        clientId,\r\n        clientSecret,\r\n        invoiceId = '' + new Date().valueOf(),\r\n        amount,\r\n        currency = 'KZT',\r\n        paymentData = {},\r\n        terminalId,\r\n        onWidgetClose,\r\n        devMode = false\r\n    }: EpayPaymentWidgetProps) => {\r\n\r\n    useEffect(() => {\r\n        if (typeof halyk == 'undefined') {\r\n            includeJS(devMode ? apiDevURL : apiProdURL)\r\n        }\r\n    }, []);\r\n\r\n    if (!visible) {\r\n        return null\r\n    }\r\n\r\n    currency = paymentData?.currency ?? currency\r\n    const invoice = (paymentData?.invoiceId || invoiceId) ?? '' + new Date().valueOf()\r\n    amount = paymentData?.amount ?? amount\r\n    terminalId = paymentData?.terminal ?? terminalId\r\n\r\n    const oauthParams = {\r\n        grant_type: oauthGrantType,\r\n        scope: scope,\r\n        client_id: clientId,\r\n        client_secret: clientSecret,\r\n        invoiceID: invoiceId,\r\n        amount: amount,\r\n        currency: currency,\r\n        terminal: terminalId\r\n    }\r\n    postData(devMode ? oauthDevURl : oauthProdURl, oauthParams)\r\n        .then((data) => {\r\n                halyk.showPaymentWidget(\r\n                    createPaymentObject(data, invoice, amount, terminalId, currency, paymentData),\r\n                    onWidgetClose ?? function () {}\r\n                );\r\n            },\r\n            () => {\r\n                alert(\"Authorization request failed\");\r\n            });\r\n\r\n    return (<></>)\r\n}","import {PaymentData} from \"./contracts\";\r\n\r\nexport async function postData(url: string, data: any) {\r\n    const formData  = new FormData();\r\n    for(const name in data) {\r\n        formData.set(name, data[name]);\r\n    }\r\n\r\n    const response = await fetch(url, {\r\n        method: \"POST\",\r\n        body: formData,\r\n    } as any);\r\n    return response.json();\r\n}\r\n\r\nexport function createPaymentObject(\r\n    auth: any,\r\n    invoiceId: string,\r\n    amount: number,\r\n    terminalId: string,\r\n    currency: string = 'KZT',\r\n    data: PaymentData = {}\r\n) {\r\n    const dummyObject = {\r\n        backLink: \"https://example.kz/success.html\",\r\n        failureBackLink: \"https://example.kz/failure.html\",\r\n        postLink: \"https://example.kz/\",\r\n        failurePostLink: \"https://example.kz/order/1123/fail\",\r\n        language: \"rus\",\r\n        description: \"Оплата в интернет магазине\",\r\n        accountId: \"testuser1\",\r\n        name: \"Arman Ali\",\r\n        data: \"{\\\"statement\\\":{\\\"name\\\":\\\"Arman     Ali\\\",\\\"invoiceID\\\":\\\"80000016\\\"}}\"\r\n    };\r\n    return {\r\n        ...dummyObject,\r\n        ...data,\r\n        auth,\r\n        invoiceId,\r\n        invoiceIdAlt: invoiceId,\r\n        amount,\r\n        terminal: terminalId,\r\n        currency\r\n    }\r\n}\r\n\r\nexport function includeJS( jsPath: string ) {\r\n    const js = document.createElement(\"script\");\r\n    js.setAttribute(\"type\", \"text/javascript\");\r\n    js.setAttribute(\"src\", jsPath);\r\n    document.getElementsByTagName(\"body\")[0].appendChild(js);\r\n}","export const apiDevURL = 'https://test-epay.homebank.kz/payform/payment-api.js'\r\nexport const apiProdURL = 'https://epay.homebank.kz/payform/payment-api.js'\r\n\r\nexport const oauthDevURl = 'https://testoauth.homebank.kz/epay2/oauth2/token'\r\nexport const oauthProdURl = 'https://epay-oauth.homebank.kz/oauth2/token'\r\n\r\nexport const oauthGrantType = \"client_credentials\"\r\nexport const scope = \"webapi usermanagement email_send verification statement statistics payment\""]}